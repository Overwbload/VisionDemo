import{M as w,P as C}from"./modal-Bv3KnZ-B.js";import{_ as U,o as i,c as n,a as t,h as c,l as m,i as D,d as M,e as B,F as I,j as k,N,t as b,z as V,A as P,m as S,k as E,y as L,r as v,b as y}from"./index-BzxHaZdx.js";import{L as x}from"./LoadingOverlay-DCSfDU47.js";import"./drone_logo3-B-egRVc4.js";const O={props:["tempProduct","resetBtn"],data(){return{localProduct:{...this.tempProduct},bsModal:"",loadingIcon:""}},methods:{confirmProduct(){this.$emit("confirm")},createImages(){this.$emit("createImg")},delImages(o){this.$emit("delImg",o)},openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()},upload(){const o=this.$refs.fileInput.files[0];this.$emit("uploadImg",o)},uploadApi(){this.loadingIcon=!0,this.$refs.fileInput.files[0]===void 0&&(this.loadingIcon=!1),this.$emit("callUploadApi"),this.$refs.fileInput.value=""}},mounted(){this.bsModal=new w(this.$refs.productModal)},watch:{tempProduct:{handler(o){this.loadingIcon=!1,this.localProduct=o},deep:!0}}},T={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-xl"},J={class:"modal-content border-0"},j={class:"modal-header bg-dark text-white"},F={id:"productModalLabel",class:"modal-title"},H={key:0},z={key:1},q=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),G={class:"modal-body"},K={class:"row"},Q={class:"col-sm-4"},W={class:"mb-2"},X={class:"mb-3"},Y=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),Z={key:0,class:"fas fa-spinner fa-pulse p-2"},tt=["src"],et=["for"],ot=["id","onUpdate:modelValue"],st=["src"],lt=["onClick"],dt={class:"col-sm-8"},at={class:"mb-3"},it=t("label",{for:"title",class:"form-label"},"標題",-1),nt={class:"row"},rt={class:"mb-3 col-md-6"},ct=t("label",{for:"category",class:"form-label"},"分類",-1),ut={class:"mb-3 col-md-6"},mt=t("label",{for:"unit",class:"form-label"},"單位",-1),pt={class:"row"},ht={class:"mb-3 col-md-6"},ft=t("label",{for:"origin_price",class:"form-label"},"原價",-1),_t={class:"mb-3 col-md-6"},bt=t("label",{for:"price",class:"form-label"},"售價",-1),gt=t("hr",null,null,-1),Pt={class:"mb-3"},vt=t("label",{for:"description",class:"form-label"},"產品描述",-1),yt={class:"mb-3"},Mt=t("label",{for:"content",class:"form-label"},"說明內容",-1),It={class:"mb-3"},Ut={class:"form-check"},wt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),kt={class:"modal-footer"},$t=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),At=["disabled"];function Ct(o,e,d,u,l,a){return i(),n("div",T,[t("div",R,[t("div",J,[t("div",j,[t("h5",F,[d.tempProduct.id?(i(),n("span",z,"編輯產品")):(i(),n("span",H,"新增產品"))]),q]),t("div",G,[t("div",K,[t("div",Q,[t("div",W,[t("div",X,[Y,c(t("input",{id:"imageUrl",type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=s=>l.localProduct.imageUrl=s)},null,512),[[m,l.localProduct.imageUrl]]),t("form",null,[t("input",{type:"file",class:"form-control my-2",id:"file",placeholder:"請選擇要上傳的圖片",onChange:e[1]||(e[1]=(...s)=>a.upload&&a.upload(...s)),ref:"fileInput"},null,544),t("button",{type:"submit",onClick:e[2]||(e[2]=D((...s)=>a.uploadApi&&a.uploadApi(...s),["prevent"]))},[M(" Upload"),l.loadingIcon?(i(),n("i",Z)):B("",!0)])])]),t("img",{class:"img-fluid",src:l.localProduct.imageUrl,alt:""},null,8,tt),(i(!0),n(I,null,k(l.localProduct.imagesUrl,(s,p)=>(i(),n("span",{key:p},[t("label",{for:"imagesUrl"+p,class:"form-label mx-4"},"輸入圖片網址",8,et),c(t("input",{id:"imagesUrl"+p,type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":g=>l.localProduct.imagesUrl[p]=g},null,8,ot),[[m,l.localProduct.imagesUrl[p]]]),t("img",{src:s,alt:"",class:"img-fluid my-2"},null,8,st),t("div",null,[t("button",{class:"btn btn-outline-danger btn-sm d-block my-2 w-100",onClick:g=>a.delImages(p)},"刪除圖片",8,lt)])]))),128)),t("div",null,[t("button",{class:"btn btn-outline-secondary btn-sm d-block my-2 w-100",onClick:e[3]||(e[3]=(...s)=>a.createImages&&a.createImages(...s))},"新增更多圖片")])])]),t("div",dt,[t("div",at,[it,c(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[4]||(e[4]=s=>l.localProduct.title=s)},null,512),[[m,l.localProduct.title]])]),t("div",nt,[t("div",rt,[ct,c(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[5]||(e[5]=s=>l.localProduct.category=s)},null,512),[[m,l.localProduct.category]])]),t("div",ut,[mt,c(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[6]||(e[6]=s=>l.localProduct.unit=s)},null,512),[[m,l.localProduct.unit]])])]),t("div",pt,[t("div",ht,[ft,c(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[7]||(e[7]=s=>l.localProduct.origin_price=s)},null,512),[[m,l.localProduct.origin_price,void 0,{number:!0}]])]),t("div",_t,[bt,c(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[8]||(e[8]=s=>l.localProduct.price=s)},null,512),[[m,l.localProduct.price,void 0,{number:!0}]])])]),gt,t("div",Pt,[vt,c(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[9]||(e[9]=s=>l.localProduct.description=s)},`\r
                    `,512),[[m,l.localProduct.description]])]),t("div",yt,[Mt,c(t("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[10]||(e[10]=s=>l.localProduct.content=s)},`\r
                    `,512),[[m,l.localProduct.content]])]),t("div",It,[t("div",Ut,[c(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[11]||(e[11]=s=>l.localProduct.is_enabled=s)},null,512),[[N,l.localProduct.is_enabled]]),wt])])])])]),t("div",kt,[$t,t("button",{type:"button",class:"btn btn-dark",disabled:d.resetBtn===!1,onClick:e[12]||(e[12]=(...s)=>a.confirmProduct&&a.confirmProduct(...s))},"確認",8,At)])])])],512)}const Dt=U(O,[["render",Ct]]),Bt={props:["tempProduct","resetBtn"],data(){return{delModal:""}},methods:{confirmDel(){this.$emit("delProduct")},delModalShow(){this.delModal.show()},delModalHide(){this.delModal.hide()}},mounted(){this.delModal=new w(this.$refs.delProductModal)}},Nt={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Vt={class:"modal-dialog"},St={class:"modal-content border-0"},Et=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Lt={class:"modal-body"},xt=t("strong",{class:"text-danger"},null,-1),Ot={class:"modal-footer"},Tt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),Rt=["disabled"];function Jt(o,e,d,u,l,a){return i(),n("div",Nt,[t("div",Vt,[t("div",St,[Et,t("div",Lt,[M(" 是否刪除【"+b(d.tempProduct.title)+"】 ",1),xt,M(" 商品(刪除後將無法恢復)。 ")]),t("div",Ot,[Tt,t("button",{type:"button",class:"btn btn-danger",disabled:d.resetBtn===!1,onClick:e[0]||(e[0]=(...s)=>a.confirmDel&&a.confirmDel(...s))},"確認刪除",8,Rt)])])])],512)}const jt=U(Bt,[["render",Jt]]),Ft={BASE_URL:"/VisionDemo/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API_NAME:"jasonfu-api-vuetest",VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2"},{VITE_APP_API_URL:h,VITE_APP_API_NAME:f}=Ft,_=V("adminProducts",{state:()=>({tempProduct:{},products:[],isNew:"",pagination:{},formData:"",loadingStatus:"",currentPage:"",resetBtn:!0}),actions:{renderProducts(o=1){this.currentPage=o;const e=`${h}/api/${f}/admin/products?page=${o}`;P.get(e).then(d=>{this.loadingStatus=!1,this.products=d.data.products,this.pagination=d.data.pagination}).catch(d=>{alert(d.response.data.message)})},openModal(o,e){this.isNew=o,o==="new"?this.tempProduct={imagesUrl:[]}:o==="edit"?this.tempProduct=JSON.parse(JSON.stringify(e)):o==="delete"&&(this.tempProduct={...e})},checkImagesArray(){this.tempProduct.imagesUrl&&(this.tempProduct.imagesUrl=this.tempProduct.imagesUrl.filter(o=>o!==""))},confirmProduct(){this.resetBtn=!1;const o=!this.tempProduct.id,e=o?`${h}/api/${f}/admin/product`:`${h}/api/${f}/admin/product/${this.tempProduct.id}`,d=o?"post":"put";if(this.checkImagesArray(),!o){const u=this.products.find(l=>l.id===this.tempProduct.id);if(u&&JSON.stringify(u)===JSON.stringify(this.tempProduct)){alert("No changes made!!"),this.resetBtn=!0;return}}P[d](e,{data:this.tempProduct}).then(u=>{o?this.renderProducts():this.renderProducts(this.currentPage),this.isNew="closeModal",this.resetBtn=!0,alert(u.data.message)}).catch(u=>{this.resetBtn=!0,alert(u.response.data.message)})},confirmDel(){if(this.resetBtn=!1,this.products.find(e=>e.id===this.tempProduct.id)){const e=`${h}/api/${f}/admin/product/${this.tempProduct.id}`;P.delete(e).then(d=>{this.renderProducts(this.currentPage),this.isNew="closeModal",this.resetBtn=!0,alert(d.data.message)}).catch(d=>{this.resetBtn=!0,alert(d.response.data.message)})}},createImages(){this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[]),this.tempProduct.imagesUrl.push("")},delImages(o){this.tempProduct.imagesUrl.splice(o,1)},upload(o){this.formData=new FormData,this.formData.append("file-to-upload",o)},uploadApi(){if(!this.formData){alert("No file to upload");return}const o=`${h}/api/${f}/admin/upload`;P.post(o,this.formData).then(e=>{alert("上傳成功"),this.tempProduct.imageUrl=e.data.imageUrl,this.formData=""}).catch(e=>{alert(e.response.data.message)})}}}),Ht={computed:{...S(_,["products","tempProduct","isNew","pagination","formData","loadingStatus","resetBtn"])},components:{Pagination:C,AdminProductModal:Dt,AdminDelProductModal:jt,LoadingOverlay:x},data(){return{}},methods:{...E(_,["renderProducts","openModal","checkImagesArray","confirmProduct","confirmDel","createImages","delImages","upload","uploadApi"])},mounted(){this.renderProducts(),L(()=>{this.isNew==="new"||this.isNew==="edit"?(_().isNew="",this.$refs.productModalComponent.openModal(),this.$refs.productModalComponent.$refs.fileInput.value=""):this.isNew==="delete"?(_().isNew="",this.$refs.delProductModalComponent.delModalShow()):this.isNew==="closeModal"&&(_().isNew="",this.$refs.productModalComponent.closeModal(),this.$refs.delProductModalComponent.delModalHide())})}},zt={class:"container"},qt={class:"d-flex justify-content-between mt-4"},Gt=t("div",null,[t("h2",null,"產品列表")],-1),Kt={class:"table mt-4"},Qt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Wt={class:"text-start"},Xt={class:"text-start"},Yt={key:0,class:"text-success"},Zt={key:1},te={class:"btn-group"},ee=["onClick"],oe=["onClick"];function se(o,e,d,u,l,a){const s=v("LoadingOverlay"),p=v("Pagination"),g=v("AdminProductModal"),$=v("AdminDelProductModal");return i(),n(I,null,[y(s,{active:o.loadingStatus,"onUpdate:active":e[0]||(e[0]=r=>o.loadingStatus=r),"is-full-page":!0},null,8,["active"]),t("div",zt,[t("div",qt,[Gt,t("div",null,[t("button",{class:"btn btn-dark",onClick:e[1]||(e[1]=r=>o.openModal("new"))}," 建立新的產品 ")])]),t("table",Kt,[Qt,t("tbody",null,[(i(!0),n(I,null,k(o.products,r=>(i(),n("tr",{key:r.id},[t("td",null,b(r.category),1),t("td",null,b(r.title),1),t("td",Wt,b(r.origin_price),1),t("td",Xt,b(r.price),1),t("td",null,[r.is_enabled===1?(i(),n("span",Yt,"啟用")):(i(),n("span",Zt,"未啟用"))]),t("td",null,[t("div",te,[t("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:A=>o.openModal("edit",r)},"編輯",8,ee),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:A=>o.openModal("delete",r)},"刪除",8,oe)])])]))),128))])]),y(p,{pages:o.pagination,onEmitPages:o.renderProducts},null,8,["pages","onEmitPages"])]),y(g,{ref:"productModalComponent","temp-product":o.tempProduct,onConfirm:o.confirmProduct,onCreateImg:o.createImages,onDelImg:o.delImages,onUploadImg:o.upload,onCallUploadApi:o.uploadApi,"reset-Btn":o.resetBtn},null,8,["temp-product","onConfirm","onCreateImg","onDelImg","onUploadImg","onCallUploadApi","reset-Btn"]),y($,{ref:"delProductModalComponent","temp-product":o.tempProduct,onDelProduct:o.confirmDel,"reset-Btn":o.resetBtn},null,8,["temp-product","onDelProduct","reset-Btn"])],64)}const ne=U(Ht,[["render",se]]);export{ne as default};
