import{z as d,A as i}from"./index-BD1DSNo1.js";import{S as n,c as u}from"./cartStore-D8mXND9M.js";const l={BASE_URL:"/VisionDemo/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API_NAME:"jasonfu-api-vuetest",VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2"},{VITE_APP_API_URL:o,VITE_APP_API_NAME:c}=l,f=d("productsStore",{state:()=>({products:[],product:[],pagination:{},currentPage:"",loadingStatus:"",loadingIcon:"",qty:1,pageBack:!1,category:[],currentCategory:"",searchText:""}),actions:{renderProducts(e="",t=1){this.searchText="",this.currentPage=t,this.currentCategory=e;const a=`${o}/api/${c}/products?category=${e}&page=${t}`;i.get(a).then(s=>{this.products=s.data.products,this.pagination=s.data.pagination,this.loadingStatus=!1,this.getCategory()}).catch(s=>{n.fire({icon:"error",title:`${s.response.data.message}`})})},getDetail(e){return new Promise((t,a)=>{this.pageBack=!1,this.product=[],this.qty=1,this.loadingStatus=!0;const s=`${o}/api/${c}/product/${e}`;i.get(s).then(r=>{this.product=r.data.product,this.product.description=this.product.description.replace(/\n/g,"<br>"),this.loadingStatus=!1}).catch(r=>{this.loadingStatus=!1,this.pageBack=!0,a(r)})})},addToCart(e,t=1){return new Promise((a,s)=>{this.loadingIcon=e;const r={product_id:e,qty:t},p=`${o}/api/${c}/cart`;i.post(p,{data:r}).then(h=>{u().getCartList(),this.loadingIcon="",a()}).catch(h=>{n.fire({icon:"error",title:`${h.response.data.message}`})})})},validateQty(){this.qty<1||this.qty.toString().includes(".")?this.qty=1:this.qty>99&&(this.qty=99)},getCategory(){if(this.category.length===0){const e=`${o}/api/${c}/products/all`;i.get(e).then(t=>{this.category=[...new Set(t.data.products.map(a=>a.category))]}).catch(t=>{n.fire({icon:"error",title:`${t.response.data.message}`})})}},search(){if(this.searchText=this.searchText.trim(),this.searchText==="")return;const e=`${o}/api/${c}/products/all`;i.get(e).then(t=>{this.pagination={total_pages:1,current_page:1,has_pre:!1,has_next:!1,category:""},this.loadingStatus=!1,this.products=t.data.products.filter(a=>a.title.toLowerCase().includes(this.searchText.toLowerCase()))}).catch(t=>{n.fire({icon:"error",title:`${t.response.data.message}`})})}}});export{f as p};
