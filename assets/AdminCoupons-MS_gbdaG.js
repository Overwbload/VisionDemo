import{L as w}from"./LoadingOverlay-p53UENqE.js";import{M as y,P as S}from"./modal-CB-15eH_.js";import{z as V,A as f,O as I,_ as $,o as u,c,a as o,h as p,l as C,N as k,d as v,t as _,m as A,k as E,y as L,r as g,b as M,F as Y,j as N,e as U}from"./index-DtPHN0Zu.js";import"./drone_logo3-B-egRVc4.js";const x={BASE_URL:"/VisionDemo/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API_NAME:"jasonfu-api-vuetest",VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2"},{VITE_APP_API_URL:r,VITE_APP_API_NAME:h}=x,m=V("couponStore",{state:()=>({coupons:[],pagination:{},loadingStatus:"",loadingIcon:"",tempCoupon:{},status:"",currentPage:"",resetBtn:!0}),actions:{getCoupon(t=1){this.currentPage=t;const e=`${r}/api/${h}/admin/coupons?page=${t}`;f.get(e).then(s=>{this.loadingStatus=!1,this.coupons=s.data.coupons,console.log(this.coupons),this.pagination=s.data.pagination}).catch(s=>{this.loadingStatus=!1,alert(s.message)})},openModal(t,e){this.status=t,t==="new"?this.tempCoupon={is_enabled:1,due_date:I().unix()}:this.tempCoupon={...e}},confirmCoupon(){this.resetBtn=!1;const t=!this.tempCoupon.id,e=t?`${r}/api/${h}/admin/coupon`:`${r}/api/${h}/admin/coupon/${this.tempCoupon.id}`,s=t?"post":"put";if(!t){const d=this.coupons.find(l=>l.id===this.tempCoupon.id);if(d&&JSON.stringify(d)===JSON.stringify(this.tempCoupon)){alert("No changes made!!"),this.resetBtn=!0;return}}f[s](e,{data:this.tempCoupon}).then(d=>{t?this.getCoupon():this.getCoupon(this.currentPage),this.getCoupon(this.currentPage),this.status="closeModal",this.resetBtn=!0,alert(d.data.message)}).catch(d=>{this.resetBtn=!0,alert(d.response.data.message)})},enabled(t){this.loadingIcon=t.id;const e=`${r}/api/${h}/admin/coupon/${t.id}`;f.put(e,{data:t}).then(s=>{this.loadingIcon="",this.getCoupon(this.currentPage),alert(s.data.message)}).catch(s=>{alert(s.response.data.message)})},confirmDel(){if(this.resetBtn=!1,this.coupons.find(e=>e.id===this.tempCoupon.id)){const e=`${r}/api/${h}/admin/coupon/${this.tempCoupon.id}`;f.delete(e).then(s=>{this.getCoupon(this.currentPage),this.status="closeModal",this.resetBtn=!0,alert(s.data.message)}).catch(s=>{this.resetBtn=!0,alert(s.response.data.message)})}}}}),O={props:["tempCoupon","resetBtn"],computed:{temp_due_date:{get(){return this.tempCoupon.due_date?this.$dayjs.unix(this.tempCoupon.due_date).format("YYYY-MM-DD"):this.$dayjs().format("YYYY-MM-DD")},set(t){this.localCoupon.due_date=this.$dayjs(t).unix()}}},data(){return{localCoupon:{...this.tempCoupon},bsModal:"",loadingIcon:""}},methods:{confirmCoupon(){this.$emit("confirm")},openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()}},mounted(){this.bsModal=new y(this.$refs.couponModal)},watch:{tempCoupon:{handler(t){this.localCoupon=t},immediate:!0,deep:!0}}},j={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},T={class:"modal-dialog modal-md"},R={class:"modal-content border-0"},F=o("div",{class:"modal-header bg-dark text-white"},[o("h5",{id:"couponModalLabel",class:"modal-title"},[o("span",null,"新增優惠券")]),o("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),H={class:"modal-body"},J={class:"row"},z={class:""},q={class:"mb-3"},G=o("label",{for:"title",class:"form-label"},"標題",-1),K={class:"mb-3"},Q=o("label",{for:"code",class:"form-label"},"優惠碼",-1),W={class:"mb-3"},X=o("label",{for:"due_date",class:"form-label"},"到期日",-1),Z={class:"mb-3"},oo=o("label",{for:"percent",class:"form-label"},"折扣百分比",-1),to={class:"input-group"},eo=o("span",{class:"input-group-text"},"%",-1),so={class:"mb-3"},no={class:"form-check"},ao=o("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),lo={class:"modal-footer"},io=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),uo=["disabled"];function co(t,e,s,d,l,i){return u(),c("div",j,[o("div",T,[o("div",R,[F,o("div",H,[o("div",J,[o("div",z,[o("div",q,[G,p(o("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[0]||(e[0]=a=>l.localCoupon.title=a)},null,512),[[C,l.localCoupon.title]])]),o("div",K,[Q,p(o("input",{id:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[1]||(e[1]=a=>l.localCoupon.code=a)},null,512),[[C,l.localCoupon.code]])]),o("div",W,[X,p(o("input",{id:"due_date",type:"date",class:"form-control",placeholder:"請輸入到期日","onUpdate:modelValue":e[2]||(e[2]=a=>i.temp_due_date=a)},null,512),[[C,i.temp_due_date]])]),o("div",Z,[oo,o("div",to,[p(o("input",{id:"percent",type:"number",class:"form-control",placeholder:"請輸入折扣百分比 ex: 90",min:"0","onUpdate:modelValue":e[3]||(e[3]=a=>l.localCoupon.percent=a)},null,512),[[C,l.localCoupon.percent]]),eo])]),o("div",so,[o("div",no,[p(o("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=a=>l.localCoupon.is_enabled=a)},null,512),[[k,l.localCoupon.is_enabled]]),ao])])])])]),o("div",lo,[io,o("button",{type:"button",class:"btn btn-dark",disabled:s.resetBtn===!1,onClick:e[5]||(e[5]=(...a)=>i.confirmCoupon&&i.confirmCoupon(...a))},"確認",8,uo)])])])],512)}const po=$(O,[["render",co]]),ro={props:["tempCoupon","resetBtn"],data(){return{delModal:""}},methods:{confirmDel(){this.$emit("delCoupon")},delModalShow(){this.delModal.show()},delModalHide(){this.delModal.hide()}},mounted(){this.delModal=new y(this.$refs.delCouponModal)}},ho={id:"delCouponModal",ref:"delCouponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delCouponModalLabel","aria-hidden":"true"},mo={class:"modal-dialog"},_o={class:"modal-content border-0"},bo=o("div",{class:"modal-header bg-danger text-white"},[o("h5",{id:"delCouponModalLabel",class:"modal-title"},[o("span",null,"刪除優惠券")]),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),fo={class:"modal-body"},Co={class:"text-danger"},go={class:"modal-footer"},Mo=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),$o=["disabled"];function vo(t,e,s,d,l,i){return u(),c("div",ho,[o("div",mo,[o("div",_o,[bo,o("div",fo,[v(" 是否刪除"),o("strong",Co,"【"+_(this.tempCoupon.title)+"】",1),v(" 商品(刪除後將無法恢復)。 ")]),o("div",go,[Mo,o("button",{type:"button",class:"btn btn-danger",disabled:s.resetBtn===!1,onClick:e[0]||(e[0]=(...a)=>i.confirmDel&&i.confirmDel(...a))},"確認刪除",8,$o)])])])],512)}const yo=$(ro,[["render",vo]]),ko={computed:{...A(m,["pagination","coupons","loadingStatus","status","loadingIcon","tempCoupon","resetBtn"])},components:{LoadingOverlay:w,PaginationComponent:S,couponModal:po,DelCouponModal:yo},methods:{...E(m,["getCoupon","openModal","enabled","confirmDel","confirmCoupon"])},mounted(){this.getCoupon(),L(()=>{this.status==="new"||this.status==="edit"?(m().status="",this.$refs.couponModal.openModal()):this.status==="delete"?(m().status="",this.$refs.delCouponModal.delModalShow()):this.status==="closeModal"&&(m().status="",this.$refs.couponModal.closeModal(),this.$refs.delCouponModal.delModalHide())})}},Po={class:"container"},Bo={class:"text-end mt-4"},Do={class:"table table-hover mt-4"},wo=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"優惠碼"),o("th",null,"啟用狀態"),o("th",null,"編輯")])],-1),So={class:"form-check form-switch"},Vo=["id","onUpdate:modelValue","onChange","disabled"],Io=["for"],Ao={key:0},Eo={key:1},Lo={key:2,class:"fas fa-spinner fa-pulse ms-2"},Yo={class:"btn-group"},No=["onClick"],Uo=["onClick"];function xo(t,e,s,d,l,i){const a=g("LoadingOverlay"),P=g("PaginationComponent"),B=g("couponModal"),D=g("DelCouponModal");return u(),c("div",Po,[M(a,{active:t.loadingStatus,"onUpdate:active":e[0]||(e[0]=n=>t.loadingStatus=n),"is-full-page":!0},null,8,["active"]),o("div",Bo,[o("button",{class:"btn btn-dark",onClick:e[1]||(e[1]=n=>t.openModal("new"))}," 建立新的優惠券 ")]),o("table",Do,[wo,o("tbody",null,[(u(!0),c(Y,null,N(t.coupons,n=>(u(),c("tr",{key:n.id},[o("td",null,_(n.title),1),o("td",null,_(n.percent)+"%",1),o("td",null,_(t.$dayjs.unix(n.due_date).format("YYYY-MM-DD")),1),o("td",null,_(n.code),1),o("td",null,[o("div",So,[p(o("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`coupon${n.id}`,"onUpdate:modelValue":b=>n.is_enabled=b,"true-value":1,"false-value":0,onChange:b=>t.enabled(n),disabled:t.loadingIcon===n.id},null,40,Vo),[[k,n.is_enabled]]),o("label",{class:"form-check-label",for:`coupon${n.id}`},[n.is_enabled?(u(),c("span",Ao,"已啟用")):(u(),c("span",Eo,"未啟用")),t.loadingIcon===n.id?(u(),c("i",Lo)):U("",!0)],8,Io)])]),o("td",null,[o("div",Yo,[o("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:b=>t.openModal("edit",n)},"編輯",8,No),o("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:b=>t.openModal("delete",n)},"刪除",8,Uo)])])]))),128))])]),M(P,{nationComponent:"",pages:t.pagination,onEmitPages:t.getCoupon},null,8,["pages","onEmitPages"]),M(B,{ref:"couponModal","temp-Coupon":t.tempCoupon,onConfirm:t.confirmCoupon,"reset-Btn":t.resetBtn},null,8,["temp-Coupon","onConfirm","reset-Btn"]),M(D,{ref:"delCouponModal","temp-coupon":t.tempCoupon,onDelCoupon:t.confirmDel,"reset-Btn":t.resetBtn},null,8,["temp-coupon","onDelCoupon","reset-Btn"])])}const Fo=$(ko,[["render",xo]]);export{Fo as default};
