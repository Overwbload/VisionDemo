import{L as D}from"./LoadingOverlay-vrsSGNhf.js";import{M as B,P as w}from"./modal-Cv3vZiXf.js";import{z as A,A as p,_ as $,o as a,c as n,a as e,t as d,e as f,F as y,j as v,h as E,l as N,d as O,m as L,k as V,y as I,r as h,b as _}from"./index-B2C3xRY_.js";import"./drone_logo3-B-egRVc4.js";const x={BASE_URL:"/VisionDemo/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API_NAME:"jasonfu-api-vuetest",VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2"},{VITE_APP_API_URL:g,VITE_APP_API_NAME:M}=x,c=A("orderStore",{state:()=>({orders:[],pagination:{},loadingStatus:"",tempOrder:{},status:"",currentPage:"",resetBtn:!0}),actions:{getOrder(s=1){this.currentPage=s;const o=`${g}/api/${M}/admin/orders?page=${s}`;p.get(o).then(t=>{this.loadingStatus=!1,this.orders=t.data.orders,this.pagination=t.data.pagination}).catch(t=>{alert(t.message)})},openModal(s,o){this.status=s,s==="edit"?this.tempOrder=JSON.parse(JSON.stringify(o)):s==="delete"&&(this.tempOrder=JSON.parse(JSON.stringify(o)))},paid(){this.tempOrder.is_paid=!0},confirmOrder(){this.resetBtn=!1;const s=this.orders.find(t=>t.id===this.tempOrder.id);if(s&&JSON.stringify(s)===JSON.stringify(this.tempOrder)){alert("No changes made!!"),this.resetBtn=!0;return}const o=`${g}/api/${M}/admin/order/${this.tempOrder.id}`;p.put(o,{data:this.tempOrder}).then(t=>{this.getOrder(this.currentPage),this.status="closeModal",this.resetBtn=!0,alert(t.data.message)}).catch(t=>{this.resetBtn=!0,alert(t.response.data.message)})},confirmDel(){if(this.resetBtn=!1,this.orders.find(o=>o.id===this.tempOrder.id)){const o=`${g}/api/${M}/admin/order/${this.tempOrder.id}`;p.delete(o).then(t=>{this.getOrder(this.currentPage),this.status="closeModal",this.resetBtn=!0,alert(t.data.message)}).catch(t=>{this.resetBtn=!0,alert(t.response.data.message)})}}}}),J={props:["tempOrder","resetBtn"],data(){return{localOrder:{...this.tempOrder},bsModal:"",loadingIcon:""}},methods:{confirmOrder(){this.$emit("confirm")},openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()},paid(){this.$emit("paid")}},mounted(){this.bsModal=new B(this.$refs.orderModal)},watch:{tempOrder:{handler(s){this.localOrder=s},immediate:!0,deep:!0}}},T={id:"orderModal",ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-xl"},U={class:"modal-content border-0"},H=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"orderModalLabel",class:"modal-title"},[e("span",null,"編輯訂單")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Y={key:0,class:"modal-body"},j={class:"row"},q={class:"col-sm-6"},F={class:"mb-2"},z=e("label",{class:"form-label"},"訂單編號：",-1),G={class:"mb-2"},K=e("label",{class:"form-label"},"建立時間：",-1),Q={class:"mb-2"},W=e("label",{class:"form-label"},"總金額：",-1),X={class:"mb-2"},Z=e("label",{class:"form-label"},"付款狀態：",-1),ee=["disabled"],te=["disabled"],se={key:0,class:"text-success"},oe=e("hr",null,null,-1),de={key:0,class:"userInfo"},le={class:"mb-2"},ae=e("label",{class:"form-label"},"姓名：",-1),ne={class:"mb-2"},re=e("label",{class:"form-label"},"電話：",-1),ie={class:"mb-2"},ce=e("label",{class:"form-label"},"E-mail：",-1),me={class:"mb-2"},ue=e("label",{class:"form-label"},"地址：",-1),he={class:"mb-2"},_e=e("label",{class:"form-label"},"留言：",-1),be={class:"col-sm-6"},pe={class:"table"},fe=e("thead",null,[e("tr",null,[e("h5",null,"購買項目")])],-1),Oe={class:"text-end"},ge=e("hr",null,null,-1),Me={class:"mb-3"},ye=e("label",{for:"description",class:"form-label"},"備註",-1),ve={class:"modal-footer"},$e=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),Pe=["disabled"];function Be(s,o,t,P,m,i){return a(),n("div",T,[e("div",R,[e("div",U,[H,t.tempOrder?(a(),n("div",Y,[e("div",j,[e("div",q,[e("div",F,[z,e("span",null,d(t.tempOrder.id),1)]),e("div",G,[K,e("span",null,d(t.tempOrder.create_at),1)]),e("div",Q,[W,e("span",null,d(s.$filters.currency(t.tempOrder.total)),1)]),e("div",X,[Z,e("button",{type:"button",class:"btn btn-outline-danger me-2",disabled:!t.tempOrder.is_paid},"未付款",8,ee),e("button",{type:"button",class:"btn btn-outline-success",disabled:t.tempOrder.is_paid,onClick:o[0]||(o[0]=(...l)=>i.paid&&i.paid(...l))},"已付款",8,te),t.tempOrder.is_paid?(a(),n("span",se," - 2024/08/20 18:33:09")):f("",!0)]),oe,t.tempOrder.user?(a(),n("div",de,[e("div",le,[ae,e("span",null,d(t.tempOrder.user.name),1)]),e("div",ne,[re,e("span",null,d(t.tempOrder.user.tel),1)]),e("div",ie,[ce,e("span",null,d(t.tempOrder.user.email),1)]),e("div",me,[ue,e("span",null,d(t.tempOrder.user.address),1)]),e("div",he,[_e,e("span",null,d(t.tempOrder.message),1)])])):f("",!0)]),e("div",be,[e("table",pe,[fe,e("tbody",null,[(a(!0),n(y,null,v(t.tempOrder.products,(l,b)=>(a(),n("tr",{key:b},[e("th",null,d(l.product.title),1),e("td",null,d(l.qty)+" / "+d(l.product.unit),1),e("td",Oe,d(s.$filters.currency(l.final_total)),1)]))),128))])]),ge,e("div",Me,[ye,E(e("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入備註內容","onUpdate:modelValue":o[1]||(o[1]=l=>m.localOrder.note=l)},null,512),[[N,m.localOrder.note]])])])])])):f("",!0),e("div",ve,[$e,e("button",{type:"button",class:"btn btn-dark",disabled:t.resetBtn===!1,onClick:o[2]||(o[2]=(...l)=>i.confirmOrder&&i.confirmOrder(...l))},"確認",8,Pe)])])])],512)}const Ce=$(J,[["render",Be]]),Se={props:["tempOrder","resetBtn"],data(){return{delModal:""}},methods:{confirmDel(){this.$emit("confirmDel")},delModalShow(){this.delModal.show()},delModalHide(){this.delModal.hide()}},mounted(){this.delModal=new B(this.$refs.delOrderModal)}},ke={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},De={class:"modal-dialog"},we={class:"modal-content border-0"},Ae=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delOrderModalLabel",class:"modal-title"},[e("span",null,"刪除訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ee={class:"modal-body"},Ne={class:"text-danger"},Le=e("br",null,null,-1),Ve={class:"modal-footer"},Ie=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1),xe=["disabled"];function Je(s,o,t,P,m,i){return a(),n("div",ke,[e("div",De,[e("div",we,[Ae,e("div",Ee,[O(" 是否刪除"),e("strong",Ne,"【"+d(t.tempOrder.id)+"】",1),O(" 訂單 "),Le,O(" (刪除後將無法恢復)。 ")]),e("div",Ve,[Ie,e("button",{type:"button",class:"btn btn-danger",disabled:t.resetBtn===!1,onClick:o[0]||(o[0]=(...l)=>i.confirmDel&&i.confirmDel(...l))},"確認刪除",8,xe)])])])],512)}const Te=$(Se,[["render",Je]]),Re={computed:{...L(c,["pagination","loadingStatus","status","orders","tempOrder","resetBtn"])},components:{PaginationComponent:w,LoadingOverlay:D,DelOrderModal:Te,OrderModal:Ce},data(){return{}},methods:{...V(c,["getOrder","openModal","confirmOrder","confirmDel","paid"])},mounted(){this.getOrder(),I(()=>{this.status==="edit"?(c().status="",this.$refs.orderModalComponent.openModal()):this.status==="delete"?(c().status="",this.$refs.delOrderModal.delModalShow()):this.status==="closeModal"&&(c().status="",this.$refs.orderModalComponent.closeModal(),this.$refs.delOrderModal.delModalHide())})}},Ue={class:"container"},He=e("h2",{class:"ms-1 mt-2"},"訂單列表",-1),Ye={class:"table table-striped"},je=e("thead",null,[e("tr",null,[e("th",null,"訂單編號"),e("th",null,"購買時間"),e("th",null,"購買項目"),e("th",null,"應付金額"),e("th",null,"付款狀態"),e("th",null,"編輯")])],-1),qe={style:{width:"250px"}},Fe={style:{width:"250px"}},ze={key:0,class:"text-success"},Ge={key:1,class:"text-danger"},Ke={class:"btn-group"},Qe=["onClick"],We=["onClick"];function Xe(s,o,t,P,m,i){const l=h("LoadingOverlay"),b=h("PaginationComponent"),C=h("OrderModal"),S=h("DelOrderModal");return a(),n("div",Ue,[_(l,{active:s.loadingStatus,"onUpdate:active":o[0]||(o[0]=r=>s.loadingStatus=r),"is-full-page":!0},null,8,["active"]),He,e("table",Ye,[je,e("tbody",null,[(a(!0),n(y,null,v(s.orders,r=>(a(),n("tr",{key:r.id},[e("td",qe,d(r.id),1),e("td",Fe,d(s.$dayjs.unix(r.create_at).format("YYYY/MM/DD HH:mm:ss")),1),e("td",null,[e("ul",null,[(a(!0),n(y,null,v(r.products,(u,k)=>(a(),n("li",{key:k},d(u.product.title)+" 〔"+d(u.qty)+"〕 ",1))),128))])]),e("td",null,"$ "+d(s.$filters.currency(r.total)),1),e("td",null,[r.is_paid?(a(),n("span",ze,"已付款")):(a(),n("span",Ge,"未付款"))]),e("td",null,[e("div",Ke,[e("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:u=>s.openModal("edit",r)},"編輯",8,Qe),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:u=>s.openModal("delete",r)},"刪除",8,We)])])]))),128))])]),_(b,{nationComponent:"",pages:s.pagination,onEmitPages:s.getOrder},null,8,["pages","onEmitPages"]),_(C,{ref:"orderModalComponent","temp-Order":s.tempOrder,onConfirm:s.confirmOrder,onPaid:s.paid,"reset-Btn":s.resetBtn},null,8,["temp-Order","onConfirm","onPaid","reset-Btn"]),_(S,{ref:"delOrderModal","temp-Order":s.tempOrder,onConfirmDel:s.confirmDel,"reset-Btn":s.resetBtn},null,8,["temp-Order","onConfirmDel","reset-Btn"])])}const ot=$(Re,[["render",Xe]]);export{ot as default};
